#!/bin/sh

# An example hook script to prepare a packed repository for use over
# dumb transports.
#
# To enable this hook, rename this file to "post-update".

# Get the latest commit message (subject and body)
message=$(git log -1 --pretty=%B)

# Print the commit message
echo "Latest commit message: $message"

# Check if the commit message contains "--newversion"
if echo "$message" | grep -q -- "--newversion"; then
  echo "Commit message contains '--newversion'. Proceeding with tag and merge operations."
  
  # Tag the current commit
  git tag v5.56 -m "$message"
  
  # Checkout the main branch
  git checkout main
  
  # Merge develop into main
  git -c diff.mnemonicprefix=false -c core.quotepath=false --no-optional-locks merge --no-ff develop
  
  # Checkout the develop branch again
  git checkout develop
else
  echo "Commit message does not contain '--newversion'. Skipping tag and merge operations."
fi
